<!DOCTYPE html>
<html lang="vi">
<head th:replace="~{/layouts/head}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<head>
    <title>Thanh Toán Tiền Phòng - Hệ Thống Quản Lý Phòng Trọ</title>
    <link rel="stylesheet" th:href="@{/css/thanhtoan-guest.css}">
</head>
<body>
    <!-- NAVBAR -->
    <div th:replace="~{/layouts/navbar}"></div>

    <div class="main-container-guest">
        <!-- Header Section -->
        <div class="header-section-guest">
            <div class="header-content-guest">
                <h1 class="header-title-guest">
                    <i class="fas fa-credit-card me-3"></i>
                    Thanh Toán
                </h1>
                <p class="header-subtitle-guest">Thanh toán nhanh chóng và an toàn</p>
                <div class="breadcrumb-nav-guest">
                    <a href="/"><i class="fas fa-home"></i> Trang chủ</a>
                    <span class="mx-2">/</span>
                    <span>Thanh toán</span>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="content-grid-guest">
            <!-- Left Column -->
            <div class="left-column-guest">
                <!-- Room Information -->
                <div class="card-guest room-info-card-guest">
                    <div class="card-header-guest">
                        <h3 class="card-title-guest">
                            <i class="fas fa-home"></i>
                            Thông Tin Phòng & Thanh Toán
                        </h3>
                    </div>
                    <div class="card-body-guest">
                        <div class="room-info-grid-guest">
                            <div class="info-item-guest">
                                <div class="info-icon-guest" style="background: linear-gradient(135deg, var(--primary-blue), var(--light-blue));">
                                    <i class="fas fa-door-open"></i>
                                </div>
                                <div class="info-content-guest">
                                    <h6>Phòng</h6>
                                    <p>A101</p>
                                </div>
                            </div>
                            <div class="info-item-guest">
                                <div class="info-icon-guest" style="background: linear-gradient(135deg, var(--success-green), #2ecc71);">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="info-content-guest">
                                    <h6>Địa chỉ</h6>
                                    <p>K814A/14 Trần Cao Vân, P.Thanh Kê, TP. Đà Nẵng</p>
                                </div>
                            </div>
                            <div class="info-item-guest">
                                <div class="info-icon-guest" style="background: linear-gradient(135deg, var(--warning-orange), #e67e22);">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="info-content-guest">
                                    <h6>Chủ trọ</h6>
                                    <p>Nguyễn Văn A</p>
                                </div>
                            </div>
                            <div class="info-item-guest">
                                <div class="info-icon-guest" style="background: linear-gradient(135deg, var(--danger-red), #e74c3c);">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="info-content-guest">
                                    <h6>Hạn thanh toán</h6>
                                    <p>05/01/2025</p>
                                </div>
                            </div>
                            <div class="info-item-guest">
                                <div class="info-icon-guest" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="info-content-guest">
                                    <h6>Kỳ thanh toán</h6>
                                    <p>Tháng 12/2024</p>
                                </div>
                            </div>
                            <div class="info-item-guest">
                                <div class="status-badge-guest status-pending-guest">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Sắp đến hạn
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Utility Meters -->
                <div class="card-guest utility-info-card-guest">
                    <div class="card-header-guest">
                        <h3 class="card-title-guest">
                            <i class="fas fa-tachometer-alt"></i>
                            Chỉ Số Điện Nước Tháng 12/2024
                        </h3>
                    </div>
                    <div class="card-body-guest">
                        <div class="utility-grid-guest">
                            <!-- Electric Meter -->
                            <div class="meter-card-guest">
                                <div class="meter-header-guest">
                                    <div>
                                        <div class="meter-icon-wrapper-guest electric-gradient-guest mb-2">
                                            <i class="fas fa-bolt "></i>
                                        </div>
                                        <div class="meter-type-guest">Điện</div>
                                    </div>
                                    <div class="text-end">
                                        <div class="usage-display-guest">71.4 kWh</div>
                                        <div class="usage-range-guest">
                                            <span>1245</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span>1316</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="meter-stats-guest">
                                    <div class="stat-item-guest">
                                        <div class="stat-value-guest">3,500 VNĐ</div>
                                        <div class="stat-label-guest">Đơn giá/kWh</div>
                                    </div>
                                    <div class="stat-item-guest">
                                        <div class="stat-value-guest">250,000 VNĐ</div>
                                        <div class="stat-label-guest">Thành tiền</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Water Meter -->
                            <div class="meter-card-guest">
                                <div class="meter-header-guest">
                                    <div>
                                        <div class="meter-icon-wrapper-guest water-gradient-guest mb-2">
                                            <i class="fas fa-tint"></i>
                                        </div>
                                        <div class="meter-type-guest">Nước</div>
                                    </div>
                                    <div class="text-end">
                                        <div class="usage-display-guest">4 m³</div>
                                        <div class="usage-range-guest">
                                            <span>156</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span>160</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="meter-stats-guest">
                                    <div class="stat-item-guest">
                                        <div class="stat-value-guest">20,000 VNĐ</div>
                                        <div class="stat-label-guest">Đơn giá/m³</div>
                                    </div>
                                    <div class="stat-item-guest">
                                        <div class="stat-value-guest">80,000 VNĐ</div>
                                        <div class="stat-label-guest">Thành tiền</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods -->
                <div class="card-guest payment-info-card-guest">
                    <div class="card-header-guest">
                        <h3 class="card-title-guest">
                            <i class="fas fa-payment"></i>
                            Chọn Phương Thức Thanh Toán
                        </h3>
                    </div>
                    <div class="card-body-guest">
                        <div class="payment-methods-guest">
                            <!-- Bank Transfer -->
                            <div class="payment-option-guest" onclick="selectPaymentMethod('bank')">
                                <div class="payment-header-guest">
                                    <input type="radio" name="payment_method" id="bank" value="bank" class="payment-radio-guest">
                                    <div class="payment-icon-guest">
                                        <i class="fas fa-university"></i>
                                    </div>
                                    <div class="payment-info-guest">
                                        <h5>Ngân Hàng</h5>
                                        <p>Chuyển khoản trực tiếp qua ngân hàng</p>
                                    </div>
                                </div>
                            </div>

                            <!-- E-Wallet -->
                            <div class="payment-option-guest" onclick="selectPaymentMethod('ewallet')">
                                <div class="payment-header-guest">
                                    <input type="radio" name="payment_method" id="ewallet" value="ewallet" class="payment-radio-guest">
                                    <div class="payment-icon-guest">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                    <div class="payment-info-guest">
                                        <h5>Ví Điện Tử</h5>
                                        <p>Thanh toán qua ví điện tử - Dễ dàng, tiện lợi</p>
                                    </div>
                                </div>
                                
                                <div class="wallet-options-guest" id="walletOptions">
                                    <h6 class="mb-3 text-primary">
                                        <i class="fas fa-wallet me-2"></i>
                                        Chọn ví điện tử:
                                    </h6>
                                    <div class="wallet-grid-guest">
                                        <div class="wallet-item-guest" onclick="selectWallet('vnpay')">
                                            <input type="radio" name="wallet" id="vnpay" value="vnpay">
                                            <img src="https://vnpay.vn/s1/statics.vnpay.vn/2023/6/0oxhzjmxbksr1686814746087.png" alt="VNPay" class="wallet-logo-guest">
                                            <div>
                                                <strong>VNPay</strong>
                                                <p class="mb-0 text-muted small">Ví điện tử VNPay</p>
                                            </div>
                                        </div>
                                        <div class="wallet-item-guest" onclick="selectWallet('zalopay')">
                                            <input type="radio" name="wallet" id="zalopay" value="zalopay">
                                            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQTlp4qW2M8xPofmuZHwEfGi9mNMWUG0zs53A&s" alt="ZaloPay" class="wallet-logo-guest">
                                            <div>
                                                <strong>ZaloPay</strong>
                                                <p class="mb-0 text-muted small">Ví điện tử ZaloPay</p>
                                            </div>
                                        </div>
                                        <div class="wallet-item-guest" onclick="selectWallet('momo')">
                                            <input type="radio" name="wallet" id="momo" value="momo">
                                            <img src="https://cdn.haitrieu.com/wp-content/uploads/2022/10/Logo-MoMo-Square.png" alt="Momo" class="wallet-logo-guest">
                                            <div>
                                                <strong>Momo</strong>
                                                <p class="mb-0 text-muted small">Ví điện tử Momo</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Cash Payment -->
                            <div class="payment-option-guest" onclick="selectPaymentMethod('cash')">
                                <div class="payment-header-guest">
                                    <input type="radio" name="payment_method" id="cash" value="cash" class="payment-radio-guest">
                                    <div class="payment-icon-guest">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    <div class="payment-info-guest">
                                        <h5>Tiền Mặt</h5>
                                        <p>Thanh toán trực tiếp - Đặt lịch hẹn trước</p>
                                    </div>
                                </div>
                                
                                <div class="cash-options-guest" id="cashOptions">
                                    <h6 class="mb-3 text-primary">
                                        <i class="fas fa-calendar-check me-2"></i>
                                        Chọn thời gian thanh toán:
                                    </h6>
                                    <div class="date-grid-guest">
                                        <div class="form-group-guest">
                                            <label class="form-label-guest">Ngày thanh toán</label>
                                            <input type="date" class="form-control-guest" id="paymentDate" min="">
                                        </div>
                                        <div class="form-group-guest">
                                            <label class="form-label-guest">Giờ thanh toán</label>
                                            <select class="form-select-guest" id="paymentTime">
                                                <option value="">Chọn giờ</option>
                                                <option value="08:00">08:00 - Sáng</option>
                                                <option value="09:00">09:00 - Sáng</option>
                                                <option value="10:00">10:00 - Sáng</option>
                                                <option value="14:00">14:00 - Chiều</option>
                                                <option value="15:00">15:00 - Chiều</option>
                                                <option value="16:00">16:00 - Chiều</option>
                                                <option value="17:00">17:00 - Chiều</option>
                                                <option value="18:00">18:00 - Tối</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group-guest">
                                        <label class="form-label-guest">Ghi chú (tùy chọn)</label>
                                        <textarea class="form-control-guest" id="paymentNote" rows="3" placeholder="Nhập ghi chú nếu có..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons-guest mb-3">
                            <button class="btn-guest btn-primary-guest" onclick="processPayment()" id="paymentBtn">
                                <i class="fas fa-credit-card"></i>
                                Thanh Toán Ngay
                            </button>
                            <button class="btn-guest btn-outline-guest" onclick="goBack()">
                                <i class="fas fa-arrow-left"></i>
                                Quay Lại
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Sidebar -->
            <div class="right-column-guest">
                <!-- Sticky Wrapper for Invoice Summary -->
                <div class="sticky-wrapper-guest">
                    <!-- Invoice Summary -->
                    <div class="card-guest invoice-info-card-guest">
                        <div class="card-header-guest">
                            <h3 class="card-title-guest">
                                <i class="fas fa-file-invoice-dollar"></i>
                                Tóm Tắt Hóa Đơn
                            </h3>
                        </div>
                        <div class="card-body-guest">
                            <div class="invoice-summary-guest">
                                <table class="invoice-table-guest">
                                    <tr>
                                        <td>Tiền phòng</td>
                                        <td>3,500,000 VNĐ</td>
                                    </tr>
                                    <tr>
                                        <td>Tiền điện (71.4 kWh)</td>
                                        <td>250,000 VNĐ</td>
                                    </tr>
                                    <tr>
                                        <td>Tiền nước (4 m³)</td>
                                        <td>80,000 VNĐ</td>
                                    </tr>
                                    <tr>
                                        <td>Phí dịch vụ</td>
                                        <td>100,000 VNĐ</td>
                                    </tr>
                                </table>
                                <div class="invoice-total-guest">
                                    <table class="invoice-table-guest">
                                        <tr>
                                            <td><strong>Tổng cộng</strong></td>
                                            <td class="total-amount-guest">3,930,000 VNĐ</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="text-center mt-3">
                                    <button class="btn-guest btn-outline-guest btn-sm-guest" onclick="showInvoiceDetails()">
                                        <i class="fas fa-eye"></i>
                                        Xem Chi Tiết Hóa Đơn
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Info -->
                    <div class="card-guest quick-info-card-guest">
                        <div class="card-header-guest">
                            <h3 class="card-title-guest">
                                <i class="fas fa-info-circle"></i>
                                Thông Tin Hữu Ích
                            </h3>
                        </div>
                        <div class="card-body-guest">
                            <div class="d-flex flex-column gap-3">
                                <div class="d-flex align-items-center gap-3">
                                    <div class="info-icon-guest" style="background: linear-gradient(135deg, var(--success-green), #2ecc71); width: 35px; height: 35px;">
                                        <i class="fas fa-shield-alt"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">Thanh toán an toàn</h6>
                                        <p class="mb-0 text-muted small">Được bảo mật SSL 256-bit</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="info-icon-guest" style="background: linear-gradient(135deg, var(--primary-blue), var(--light-blue)); width: 35px; height: 35px;">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">Xử lý nhanh chóng</h6>
                                        <p class="mb-0 text-muted small">Giao dịch được xử lý trong 1-2 phút</p>
                                    </div>
                                </div>
                                <div class="d-flex align-items-center gap-3">
                                    <div class="info-icon-guest" style="background: linear-gradient(135deg, var(--warning-orange), #e67e22); width: 35px; height: 35px;">
                                        <i class="fas fa-headset"></i>
                                    </div>
                                    <div>
                                        <h6 class="mb-1">Hỗ trợ 24/7</h6>
                                        <p class="mb-0 text-muted small">Liên hệ: 0123.456.789</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Link to Payment History -->
                    <div class="card-guest mt-3">
                        <div class="card-body-guest text-center">
                            <a href="/khach-thue/lichsu-thanhtoan" class="btn-guest btn-outline-guest w-100">
                                <i class="fas fa-history me-2"></i>
                                Xem Lịch Sử Thanh Toán
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Modal chi tiết hóa đơn -->
    <div class="modal fade" id="invoiceModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--primary-blue), var(--light-blue)); color: white;">
                    <h5 class="modal-title">
                        <i class="fas fa-file-invoice me-2"></i>
                        Chi Tiết Hóa Đơn Tháng 12/2024
                        <span class="modal-title-text d-none">Phòng A101</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Header Info -->
                    <div class="invoice-header-info-guest">
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <div class="info-section-guest">
                                    <h6 class="info-section-title-guest">
                                        <i class="fas fa-file-alt me-2"></i>
                                        Thông tin hóa đơn
                                    </h6>
                                    <div class="info-grid-guest">
                                        <div class="info-row-guest">
                                            <span class="info-label-guest">Mã hóa đơn:</span>
                                            <span class="info-value-guest text-primary">HD001234</span>
                                        </div>
                                        <div class="info-row-guest">
                                            <span class="info-label-guest">Ngày tạo:</span>
                                            <span class="info-value-guest">01/12/2024</span>
                                        </div>
                                        <div class="info-row-guest">
                                            <span class="info-label-guest">Hạn thanh toán:</span>
                                            <span class="info-value-guest text-danger">05/01/2025</span>
                                        </div>
                                        <div class="info-row-guest">
                                            <span class="info-label-guest">Trạng thái:</span>
                                            <span class="info-value-guest">
                                                <span class="status-badge-guest status-pending-guest">
                                                    <i class="fas fa-clock"></i> Chưa thanh toán
                                                </span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="info-section-guest">
                                    <h6 class="info-section-title-guest">
                                        <i class="fas fa-home me-2"></i>
                                        Thông tin phòng
                                    </h6>
                                    <div class="info-grid-guest">
                                        <div class="info-row-guest">
                                            <span class="info-label-guest">Phòng:</span>
                                            <span class="info-value-guest">A101 - Tầng 1</span>
                                        </div>
                                        <div class="info-row-guest">
                                            <span class="info-label-guest">Địa chỉ:</span>
                                            <span class="info-value-guest">123 Đường ABC, Quận 1, TP.HCM</span>
                                        </div>
                                        <div class="info-row-guest">
                                            <span class="info-label-guest">Chủ trọ:</span>
                                            <span class="info-value-guest">Nguyễn Văn A</span>
                                        </div>
                                        <div class="info-row-guest">
                                            <span class="info-label-guest">Số điện thoại:</span>
                                            <span class="info-value-guest">0123.456.789</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Desktop Table -->
                    <div class="invoice-table-desktop-guest">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead style="background: var(--bg-blue);">
                                    <tr>
                                        <th>Khoản thu</th>
                                        <th>Đơn giá</th>
                                        <th>Số lượng</th>
                                        <th>Chỉ số</th>
                                        <th class="text-end">Thành tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><strong>Tiền phòng</strong></td>
                                        <td>3,500,000 VNĐ</td>
                                        <td>1 tháng</td>
                                        <td>-</td>
                                        <td class="text-end"><strong>3,500,000 VNĐ</strong></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Tiền điện</strong></td>
                                        <td>3,500 VNĐ/kWh</td>
                                        <td>71.4 kWh</td>
                                        <td>1245 → 1316</td>
                                        <td class="text-end"><strong>250,000 VNĐ</strong></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Tiền nước</strong></td>
                                        <td>20,000 VNĐ/m³</td>
                                        <td>4 m³</td>
                                        <td>156 → 160</td>
                                        <td class="text-end"><strong>80,000 VNĐ</strong></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Tiền rác</strong></td>
                                        <td>30,000 VNĐ</td>
                                        <td>1</td>
                                        <td>-</td>
                                        <td class="text-end"><strong>30,000 VNĐ</strong></td>
                                    </tr>
                                    <tr>
                                        <td><strong>Phí khác</strong></td>
                                        <td>100,000 VNĐ</td>
                                        <td>1</td>
                                        <td>-</td>
                                        <td class="text-end"><strong>100,000 VNĐ</strong></td>
                                    </tr>
                                </tbody>
                                <tfoot style="background: var(--bg-blue);">
                                    <tr>
                                        <th colspan="4"><strong>Tổng cộng</strong></th>
                                        <th class="text-end"><strong style="color: var(--primary-blue); font-size: 1.2rem;">3,930,000 VNĐ</strong></th>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <!-- Mobile Cards -->
                    <div class="invoice-cards-mobile-guest">
                        <!-- Room Fee Card -->
                        <div class="invoice-item-card-guest">
                            <div class="invoice-card-header-guest">
                                <div class="invoice-icon-guest room-icon-guest">
                                    <i class="fas fa-home"></i>
                                </div>
                                <div class="invoice-card-title-guest">
                                    <h6>Tiền phòng</h6>
                                    <p>Phòng A101 - Tháng 12/2024</p>
                                </div>
                                <div class="invoice-card-amount-guest">3,500,000 VNĐ</div>
                            </div>
                            <div class="invoice-card-details-guest">
                                <div class="detail-row-guest">
                                    <span>Đơn giá:</span>
                                    <span>3,500,000 VNĐ</span>
                                </div>
                                <div class="detail-row-guest">
                                    <span>Thời gian:</span>
                                    <span>1 tháng</span>
                                </div>
                            </div>
                        </div>

                        <!-- Electric Fee Card -->
                        <div class="invoice-item-card-guest">
                            <div class="invoice-card-header-guest">
                                <div class="invoice-icon-guest electric-icon-guest">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="invoice-card-title-guest">
                                    <h6>Tiền điện</h6>
                                    <p>Chỉ số: 1245 → 1316</p>
                                </div>
                                <div class="invoice-card-amount-guest">250,000 VNĐ</div>
                            </div>
                            <div class="invoice-card-details-guest">
                                <div class="detail-row-guest">
                                    <span>Đơn giá:</span>
                                    <span>3,500 VNĐ/kWh</span>
                                </div>
                                <div class="detail-row-guest">
                                    <span>Sử dụng:</span>
                                    <span>71.4 kWh</span>
                                </div>
                            </div>
                        </div>

                        <!-- Water Fee Card -->
                        <div class="invoice-item-card-guest">
                            <div class="invoice-card-header-guest">
                                <div class="invoice-icon-guest water-icon-guest">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="invoice-card-title-guest">
                                    <h6>Tiền nước</h6>
                                    <p>Chỉ số: 156 → 160</p>
                                </div>
                                <div class="invoice-card-amount-guest">80,000 VNĐ</div>
                            </div>
                            <div class="invoice-card-details-guest">
                                <div class="detail-row-guest">
                                    <span>Đơn giá:</span>
                                    <span>20,000 VNĐ/m³</span>
                                </div>
                                <div class="detail-row-guest">
                                    <span>Sử dụng:</span>
                                    <span>4 m³</span>
                                </div>
                            </div>
                        </div>

                        <!-- Service Fee Card -->
                        <div class="invoice-item-card-guest">
                            <div class="invoice-card-header-guest">
                                <div class="invoice-icon-guest service-icon-guest">
                                    <!-- <i class="fas fa-cogs"></i> -->
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                                <div class="invoice-card-title-guest">
                                    <h6>Tiền rác</h6>
                                    <p>Phí quản lý, vệ sinh chung</p>
                                </div>
                                <div class="invoice-card-amount-guest">30,000 VNĐ</div>
                            </div>
                            <div class="invoice-card-details-guest">
                                <div class="detail-row-guest">
                                    <span>Loại phí:</span>
                                    <span>Cố định</span>
                                </div>
                                <div class="detail-row-guest">
                                    <span>Chu kỳ:</span>
                                    <span>Hàng tháng</span>
                                </div>
                            </div>
                        </div>
                        <div class="invoice-item-card-guest">
                            <div class="invoice-card-header-guest">
                                <div class="invoice-icon-guest service-icon-guest">
                                    <i class="fas fa-cogs"></i>
                                </div>
                                <div class="invoice-card-title-guest">
                                    <h6>Phí khác</h6>
                                    <p>Phí quản lý, vệ sinh chung</p>
                                </div>
                                <div class="invoice-card-amount-guest">100,000 VNĐ</div>
                            </div>
                            <div class="invoice-card-details-guest">
                                <div class="detail-row-guest">
                                    <span>Loại phí:</span>
                                    <span>Cố định</span>
                                </div>
                                <div class="detail-row-guest">
                                    <span>Chu kỳ:</span>
                                    <span>Hàng tháng</span>
                                </div>
                            </div>
                        </div>

                        <!-- Total Card -->
                        <div class="invoice-total-card-guest">
                            <div class="total-card-content-guest">
                                <div class="total-icon-guest">
                                    <i class="fas fa-calculator"></i>
                                </div>
                                <div class="total-info-guest">
                                    <h5>Tổng cộng</h5>
                                    <p>Tổng số tiền cần thanh toán</p>
                                </div>
                                <div class="total-amount-guest">3,930,000 VNĐ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-guest btn-outline-guest" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>
                        <span class="btn-text-guest">Đóng</span>
                    </button>
                    <button type="button" class="btn-guest btn-primary-guest">
                        <i class="fas fa-download me-2"></i>
                        <span class="btn-text-guest">Tải Hóa Đơn PDF</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{/layouts/footer}"></div>

    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> -->
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('paymentDate').setAttribute('min', today);
        });

        function selectPaymentMethod(method) {
            // Remove active class from all payment methods
            document.querySelectorAll('.payment-option-guest').forEach(el => {
                el.classList.remove('active');
            });
            
            // Add active class to selected method
            event.currentTarget.classList.add('active');
            
            // Check the radio button
            document.getElementById(method).checked = true;
            
            // Hide all sub-options
            document.getElementById('walletOptions').style.display = 'none';
            document.getElementById('cashOptions').style.display = 'none';
            
            // Show relevant sub-options
            if (method === 'ewallet') {
                document.getElementById('walletOptions').style.display = 'block';
            } else if (method === 'cash') {
                document.getElementById('cashOptions').style.display = 'block';
            }
        }

        function selectWallet(wallet) {
            event.stopPropagation();
            
            // Remove active class from all wallet options
            document.querySelectorAll('.wallet-item-guest').forEach(el => {
                el.classList.remove('active');
            });
            
            // Add active class to selected wallet
            event.currentTarget.classList.add('active');
            
            // Check the radio button
            document.getElementById(wallet).checked = true;
        }

        function showInvoiceDetails() {
            const modal = new bootstrap.Modal(document.getElementById('invoiceModal'));
            modal.show();
        }

        // Removed viewInvoice and scrollToPayment as they are now handled in lich-su-thanh-toan.html or by direct link

        function processPayment() {
            const selectedMethod = document.querySelector('input[name="payment_method"]:checked');
            const paymentBtn = document.getElementById('paymentBtn');
            
            if (!selectedMethod) {
                alert('Vui lòng chọn phương thức thanh toán!');
                return;
            }
            
            let message = 'Xác nhận thanh toán 3,930,000 VNĐ bằng ';
            
            switch(selectedMethod.value) {
                case 'bank':
                    message += 'chuyển khoản ngân hàng?';
                    break;
                case 'ewallet':
                    const selectedWallet = document.querySelector('input[name="wallet"]:checked');
                    if (!selectedWallet) {
                        alert('Vui lòng chọn ví điện tử!');
                        return;
                    }
                    message += `ví điện tử ${selectedWallet.value.toUpperCase()}?`;
                    break;
                case 'cash':
                    const paymentDate = document.getElementById('paymentDate').value;
                    const paymentTime = document.getElementById('paymentTime').value;
                    
                    if (!paymentDate || !paymentTime) {
                        alert('Vui lòng chọn ngày và giờ thanh toán!');
                        return;
                    }
                    
                    message += `tiền mặt vào ngày ${paymentDate} lúc ${paymentTime}?`;
                    break;
            }
            
            if (confirm(message)) {
                // Show loading state
                paymentBtn.innerHTML = '<span class="loading-guest me-2"></span>Đang xử lý thanh toán...';
                paymentBtn.disabled = true;
                
                setTimeout(() => {
                    paymentBtn.innerHTML = '<i class="fas fa-check me-2"></i>Thanh toán thành công!';
                    paymentBtn.classList.remove('btn-primary-guest');
                    paymentBtn.classList.add('btn-success-guest');
                    
                    setTimeout(() => {
                        if (selectedMethod.value === 'cash') {
                            alert('Đã đặt lịch thanh toán thành công! Chủ trọ sẽ liên hệ với bạn để xác nhận thời gian.');
                        } else {
                            alert('Thanh toán thành công! Cảm ơn bạn đã thanh toán đúng hạn. Hóa đơn đã được gửi qua email.');
                        }
                        
                        // Reset button after 3 seconds
                        setTimeout(() => {
                            paymentBtn.innerHTML = '<i class="fas fa-credit-card"></i> Thanh Toán Ngay';
                            paymentBtn.classList.remove('btn-success-guest');
                            paymentBtn.classList.add('btn-primary-guest');
                            paymentBtn.disabled = false;
                        }, 3000);
                    }, 1500);
                }, 2500);
            }
        }

        function goBack() {
            if (confirm('Bạn có chắc chắn muốn quay lại? Thông tin đã nhập sẽ không được lưu.')) {
                window.history.back();
            }
        }

        // Prevent form submission on Enter key
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
            }
        });

        // Add smooth scroll behavior
        document.documentElement.style.scrollBehavior = 'smooth';

        // Auto-hide alerts after 5 seconds
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Enhanced form validation
        function validatePaymentForm() {
            const selectedMethod = document.querySelector('input[name="payment_method"]:checked');
            
            if (!selectedMethod) {
                showAlert('Vui lòng chọn phương thức thanh toán!', 'warning');
                return false;
            }
            
            if (selectedMethod.value === 'ewallet') {
                const selectedWallet = document.querySelector('input[name="wallet"]:checked');
                if (!selectedWallet) {
                    showAlert('Vui lòng chọn ví điện tử!', 'warning');
                    return false;
                }
            }
            
            if (selectedMethod.value === 'cash') {
                const paymentDate = document.getElementById('paymentDate').value;
                const paymentTime = document.getElementById('paymentTime').value;
                
                if (!paymentDate || !paymentTime) {
                    showAlert('Vui lòng chọn ngày và giờ thanh toán!', 'warning');
                    return false;
                }
                
                // Check if selected date is not in the past
                const selectedDateTime = new Date(paymentDate + ' ' + paymentTime);
                const now = new Date();
                
                if (selectedDateTime <= now) {
                    showAlert('Vui lòng chọn thời gian trong tương lai!', 'warning');
                    return false;
                }
            }
            
            return true;
        }

        // Add click handlers for wallet selection
        document.addEventListener('click', function(e) {
            if (e.target.closest('.wallet-item-guest')) {
                const walletItem = e.target.closest('.wallet-item-guest');
                const radio = walletItem.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                    selectWallet(radio.value);
                }
            }
        });
    </script>
</body>
</html>
