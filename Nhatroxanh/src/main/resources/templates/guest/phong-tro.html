<!DOCTYPE html>
<html lang="en">

<head th:replace="~{/layouts/head}">
    <title>Chi Tiết - Nhà Trọ Xanh</title>
</head>

<body>
    <!-- NAVBAR -->
    <div th:replace="~{/layouts/navbar}"></div>

    <!-- LOGIN MODAL -->
    <div th:replace="~{/layouts/login-modal}"></div>

    <!-- REGISTER MODAL -->
    <div th:replace="~{/layouts/register-modal}"></div>

    <!-- VERIFICATION MODAL -->
    <div th:replace="~{/layouts/verification-modal}"></div>

    <div th:replace="~{/layouts/loc-danhmuc}"></div>

    <div class="container py-4">
        <h5 class="fw-bold">CHO THUÊ NHÀ TRỌ, PHÒNG TRỌ GIÁ RẺ MỚI NHẤT</h5>
        <div class="row">
            <!-- Danh sách nhà trọ -->
            <div class="col-md-8 danhmuc-nhatro">
                <!-- Thanh top: Tổng kết quả + Sắp xếp -->
                <div class="d-flex justify-content-between align-items-center mb-3 px-1">
                    <p class="m-0 fw-semibold">
                        Tổng <span class="text-dark" th:text="${#lists.size(posts)}">0</span> kết quả
                    </p>
                    <form action="" method="get">
                        <div class="sort-box d-flex align-items-center">
                            <span class="w-100 text-secondary">Sắp xếp theo</span>
                            <select class="form-select form-select-sm sort-select" name="sort"
                                onchange="this.form.submit()">
                                <option value="all" th:selected="${param.sort == null or param.sort == 'all'}">Tất cả
                                </option>
                                <option value="latest" th:selected="${param.sort == 'latest'}">Mới nhất</option>
                                <option value="price_asc" th:selected="${param.sort == 'price_asc'}">Giá tăng dần
                                </option>
                                <option value="price_desc" th:selected="${param.sort == 'price_desc'}">Giá giảm dần
                                </option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="post-card mb-3 d-flex" th:each="post : ${posts}">
                    <!-- Ảnh -->
                    <div class="post-img position-relative">
                        <a th:href="@{/chi-tiet/{id}(id=${post.postId})}">
                            <!-- Improved image handling -->
                            <img th:if="${post.images != null and !post.images.isEmpty()}"
                                th:src="${post.images[0].url}" alt="Phòng trọ" class="img-fluid"
                                onerror="this.src='/images/no-image.jpg'" />
                            <img th:unless="${post.images != null and !post.images.isEmpty()}"
                                src="/images/no-image.jpg" alt="Không có ảnh" class="img-fluid" />
                        </a>
                        <button class="btn-favorite">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>

                    <!-- Nội dung -->
                    <div class="post-info ps-3 d-flex flex-column justify-content-between">
                        <div>
                            <h6 class="fw-bold mb-1">
                                <a th:href="@{/chi-tiet/{id}(id=${post.postId})}"
                                    class="text-dark text-decoration-none hover-text-primary"
                                    th:text="${post.title}">Tiêu đề</a>
                            </h6>

                            <div class="text-muted small mb-1">
                                <span class="text-dark">Từ</span>
                                <span class="text-danger fw-bold"
                                    th:text="${#numbers.formatDecimal(post.price, 0, 'COMMA', 0, 'POINT') + ' VNĐ'}">
                                    2.5 triệu
                                </span>
                                <span class="text-muted">/tháng</span>
                            </div>

                            <div class="d-flex gap-2 mb-2">
                                <span class="badge bg-light border text-dark small px-2"
                                    th:text="${post.area + 'm²'}">Diện tích</span>
                                <!-- Add category badge -->
                                <span class="badge bg-primary text-white small px-2"
                                    th:text="${post.category.name}">Danh mục</span>
                            </div>

                            <!-- Simplified address display -->
                            <div class="text-muted small">
                                <i class="fas fa-map-marker-alt me-1 text-danger"></i>
                                <span th:if="${post.address != null}"
                                    th:text="${post.address.street != null ? post.address.street + ', ' : ''} + 
                                   ${post.address.ward != null ? post.address.ward.name + ', ' : ''} + 
                                   ${post.address.ward != null and post.address.ward.district != null ? post.address.ward.district.name + ', ' : ''} + 
                                   ${post.address.ward != null and post.address.ward.district != null and post.address.ward.district.province != null ? post.address.ward.district.province.name : ''}">
                                </span>
                                <span th:unless="${post.address != null}">
                                    Địa chỉ chưa cập nhật
                                </span>
                            </div>

                            <!-- Add post date -->
                            <div class="text-muted small mt-1">
                                <i class="fas fa-clock me-1"></i>
                                <span th:text="${#dates.format(post.createdAt, 'dd/MM/yyyy')}">Ngày đăng</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Có thể lặp lại nhiều item tương tự -->
            </div>

            <!-- Bộ lọc -->
            <div class="col-md-4 danhmuc-boloc">
                <div class="filter-card">
                    <h6 class="filter-title">
                        <i class="fas fa-filter"></i> Lọc tìm kiếm phòng
                    </h6>

                    <div class="filter-section">
                        <label class="filter-label">Diện tích</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="area" id="area1" checked>
                            <label class="form-check-label" for="area1">Dưới 10m²</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="area" id="area2">
                            <label class="form-check-label" for="area2">10 - 20m²</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="area" id="area3">
                            <label class="form-check-label" for="area3">20 - 25m²</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="area" id="area4">
                            <label class="form-check-label" for="area4">25 - 30m²</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="area" id="area5">
                            <label class="form-check-label" for="area5">Trên 30m²</label>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label class="filter-label">Tiện nghi</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="t1">
                            <label class="form-check-label" for="t1">Gác lửng</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="t2">
                            <label class="form-check-label" for="t2">Wifi</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="t3">
                            <label class="form-check-label" for="t3">Vệ sinh trong</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="t4">
                            <label class="form-check-label" for="t4">Phòng tắm</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="t5">
                            <label class="form-check-label" for="t5">Bình nóng lạnh</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="t6">
                            <label class="form-check-label" for="t6">Kệ bếp</label>
                        </div>
                    </div>

                    <div class="filter-section">
                        <label class="filter-label">Đối tượng</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="d1">
                            <label class="form-check-label" for="d1">Đi học</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="d2">
                            <label class="form-check-label" for="d2">Đi làm</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="d3">
                            <label class="form-check-label" for="d3">Gia đình</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="d4">
                            <label class="form-check-label" for="d4">Cặp đôi</label>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between mt-3">
                        <button class="btn btn-blue">Tìm ngay</button>
                        <button class="btn btn-outline-blue">Xóa bộ lọc</button>
                    </div>
                </div>


            </div>
        </div>
    </div>


</body>

</html>