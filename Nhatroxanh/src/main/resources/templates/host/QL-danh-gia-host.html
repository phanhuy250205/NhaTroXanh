<!DOCTYPE html>
<html lang="vi">

<head th:replace="~{/layouts/head}" />

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quản lý đánh giá - Nhà Trọ Xanh</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #3498db;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --light-bg: #f8fafc;
      --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --card-hover-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .page-header {
      background: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      margin-bottom: 2rem;
      border: 1px solid #e2e8f0;
    }

    .page-title {
      color: var(--primary-color);
      font-weight: 700;
      font-size: 2rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .btn {
      border-radius: 16px;
      padding: 0.75rem 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .page-title i {
      background: linear-gradient(135deg, var(--primary-color), #3b82f6);
      color: white;
      padding: 0.5rem;
      border-radius: 12px;
      font-size: 1.5rem;
    }

    .filter-section {
      background: white;
      padding: 1.5rem;
      border-radius: 16px;
      box-shadow: var(--card-shadow);
      margin-bottom: 2rem;
      border: 1px solid #e2e8f0;
    }

    .filter-title {
      color: var(--secondary-color);
      font-weight: 600;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .form-control,
    .form-select {
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 0.75rem 1rem;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .accordion {
      background: transparent;
    }

    .accordion-item {
      background: white;
      border: none;
      border-radius: 16px;
      margin-bottom: 1rem;
      box-shadow: var(--card-shadow);
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .accordion-item:hover {
      box-shadow: var(--card-hover-shadow);
      transform: translateY(-2px);
    }

    .accordion-header {
      border-radius: 16px;
    }

    .accordion-button {
      background: linear-gradient(135deg, #f8fafc, #e2e8f0);
      border: none;
      padding: 1.5rem 2rem;
      font-weight: 600;
      font-size: 1.1rem;
      color: var(--primary-color);
      border-radius: 16px;
      transition: all 0.3s ease;
    }

    .accordion-button:not(.collapsed) {
      background: linear-gradient(135deg, var(--primary-color), #3b82f6);
      color: white;
      box-shadow: none;
    }

    .accordion-button:focus {
      box-shadow: none;
      border: none;
    }

    .accordion-button::after {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%232563eb'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
      transition: transform 0.3s ease;
    }

    .accordion-button:not(.collapsed)::after {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='white'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
    }

    .accordion-body {
      padding: 2rem;
      background: #f8fafc;
    }

    .review-item {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .review-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, var(--primary-color), #3b82f6);
    }

    .review-item:hover {
      border-color: var(--primary-color);
      box-shadow: var(--card-hover-shadow);
      transform: translateY(-2px);
    }

    .reviewer-info {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .reviewer-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary-color), #3b82f6);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 1.2rem;
    }

    .reviewer-name {
      font-weight: 600;
      color: var(--primary-color);
      font-size: 1.1rem;
      margin: 0;
    }

    .review-rating {
      color: var(--warning-color);
      font-size: 1.2rem;
      margin-left: auto;
    }

    .review-content {
      color: var(--secondary-color);
      line-height: 1.6;
      margin-bottom: 1rem;
    }

    .review-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
    }

    .btn {
      border-radius: 10px;
      padding: 0.75rem 1rem;
      font-weight: 500;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary-color), #3b82f6);
      border: none;
      color: white;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #1d4ed8, var(--primary-color));
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .btn-outline-primary {
      color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .btn-outline-primary:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      transform: translateY(-1px);
    }

    .btn-outline-danger {
      color: var(--danger-color);
      border-color: var(--danger-color);
    }

    .btn-outline-danger:hover {
      background: var(--danger-color);
      border-color: var(--danger-color);
      transform: translateY(-1px);
    }

    .modal-content {
      border: none;
      border-radius: 20px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    .modal-header {
      background: linear-gradient(135deg, var(--primary-color), #3b82f6);
      color: white;
      border-radius: 20px 20px 0 0;
      padding: 1.5rem 2rem;
    }

    .modal-title {
      font-weight: 600;
      font-size: 1.3rem;
    }

    .btn-close {
      filter: brightness(0) invert(1);
    }

    .modal-body {
      padding: 2rem;
    }

    .modal-info-item {
      background: #f8fafc;
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
      border-left: 4px solid var(--primary-color);
    }

    .modal-info-label {
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .modal-info-value {
      color: var(--secondary-color);
      margin: 0;
    }

    .stats-card {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: var(--card-shadow);
      text-align: center;
      transition: all 0.3s ease;
    }

    .stats-card:hover {
      box-shadow: var(--card-hover-shadow);
      transform: translateY(-2px);
    }

    .stats-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1rem;
      font-size: 1.5rem;
      color: white;
    }

    .stats-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }

    .stats-label {
      color: var(--secondary-color);
      font-weight: 500;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--secondary-color);
    }

    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 1rem;
      }

      .filter-section .d-flex {
        flex-direction: column;
        gap: 1rem;
      }

      .filter-section .w-25 {
        width: 100% !important;
      }

      .reviewer-info {
        flex-direction: column;
        align-items: flex-start;
      }

      .review-rating {
        margin-left: 0;
      }
    }

    .custom-toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1055;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .custom-toast {
      display: flex;
      align-items: center;
      background-color: #e6f7f0;
      color: #1a2e05;
      padding: 12px 16px;
      border-left: 5px solid #10b981;
      border-radius: 10px;
      min-width: 320px;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      font-size: 15px;
      position: relative;
      animation: slideIn 0.3s ease-out;
    }

    .custom-toast.error {
      background-color: #fff0f0;
      border-left-color: #ef4444;
      color: #7f1d1d;
    }

    .toast-icon {
      margin-right: 10px;
      font-size: 18px;
      color: #10b981;
    }

    .custom-toast.error .toast-icon {
      color: #ef4444;
    }

    .toast-message {
      flex: 1;
    }

    .toast-close {
      background: none;
      border: none;
      font-size: 18px;
      color: #999;
      cursor: pointer;
      transition: color 0.2s;
    }

    .toast-close:hover {
      color: #333;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(50px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .custom-tab {
      border-bottom: none;
      display: flex;
      gap: 1rem;
      background: #f4f8ff;
      padding: 10px 15px;
      border-radius: 12px;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      justify-content: start;
    }

    .custom-tab .nav-link {
      border: none;
      padding: 10px 20px;
      font-weight: 500;
      color: #555;
      background-color: transparent;
      border-radius: 20px;
      transition: all 0.2s ease;
    }

    .custom-tab .nav-link:hover {
      background-color: #e0ebff;
      color: #0056b3;
    }

    .custom-tab .nav-link.active {
      background-color: #0d6efd;
      color: #fff;
      font-weight: 600;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }

    @media (max-width: 576px) {
      .custom-tab {
        flex-direction: column;
        gap: 0.5rem;
      }
    }
  </style>
</head>

<body>
  <div th:replace="~{/layouts/sidebar-host}"></div>
  <div class="main-content">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">
        <i class="fas fa-star"></i>
        Quản lý đánh giá theo khu trọ
      </h1>
    </div>
    <div class="custom-toast-container">
      <div th:if="${successMessage}" class="custom-toast success">
        <i class="toast-icon fas fa-check-circle"></i>
        <span class="toast-message" th:text="${successMessage}"></span>
        <button class="toast-close" aria-label="Đóng">×</button>
      </div>
      <div th:if="${errorMessage}" class="custom-toast error">
        <i class="toast-icon fas fa-exclamation-circle"></i>
        <span class="toast-message" th:text="${errorMessage}"></span>
        <button class="toast-close" aria-label="Đóng">×</button>
      </div>
    </div>
    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-md-3 mb-3">
        <div class="stats-card">
          <div class="stats-icon" style="background: linear-gradient(135deg, var(--primary-color), #3b82f6);">
            <i class="fas fa-building"></i>
          </div>
          <div class="stats-number" th:text="${totalHostels}">8</div>
          <div class="stats-label">Khu trọ</div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="stats-card">
          <div class="stats-icon" style="background: linear-gradient(135deg, var(--success-color), #22c55e);">
            <i class="fas fa-comments"></i>
          </div>
          <div class="stats-number" th:text="${totalReviews}">47</div>
          <div class="stats-label">Tổng đánh giá</div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="stats-card">
          <div class="stats-icon" style="background: linear-gradient(135deg, var(--warning-color), #fbbf24);">
            <i class="fas fa-star"></i>
          </div>
          <div class="stats-number" th:text="${#numbers.formatDecimal(averageRating, 1, 1)}">4.6</div>
          <div class="stats-label">Điểm trung bình</div>
        </div>
      </div>
      <div class="col-md-3 mb-3">
        <div class="stats-card">
          <div class="stats-icon" style="background: linear-gradient(135deg, #8b5cf6, #a855f7);">
            <i class="fas fa-trophy"></i>
          </div>
          <div class="stats-number" th:text="${fiveStarCount}">23</div>
          <div class="stats-label">5 sao</div>
        </div>
      </div>
    </div>
    <form method="get" th:action="@{/chu-tro/danh-gia}" class="d-flex gap-3 mb-3">
      <input type="text" name="keyword" class="form-control w-25" placeholder="🔍 Tìm khu trọ..."
        th:value="${keyword}" />

      <!-- <select name="time" class="form-select w-25">
        <option th:value="">📅 Mặc định</option>
        <option th:value="newest" th:selected="${time == 'newest'}">Mới nhất</option>
        <option th:value="oldest" th:selected="${time == 'oldest'}">Cũ nhất</option>
      </select> -->

      <button type="submit" class="btn btn-primary w-25">
        <i class="fas fa-search me-1"></i> Tìm kiếm
      </button>
    </form>

    <div class="container mt-4">
      <!-- Tabs -->
      <ul class="nav custom-tab" id="reviewTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="room-tab" data-bs-toggle="tab" data-bs-target="#roomReviews" type="button"
            role="tab">Đánh giá phòng</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="post-tab" data-bs-toggle="tab" data-bs-target="#postReviews" type="button"
            role="tab">Đánh giá bài đăng</button>
        </li>
      </ul>

      <div class="tab-content mt-3">
        <!-- Tab 1: Đánh giá phòng -->
        <div class="tab-pane fade show active" id="roomReviews" role="tabpanel">
          <div class="accordion" id="hostReviewAccordion1">
            <div th:each="hostel : ${hostels}" class="accordion-item">
              <h2 class="accordion-header" th:id="'headingRoom' + ${hostel.hostelId}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  th:data-bs-target="'#collapseRoom' + ${hostel.hostelId}">
                  <i class="fas fa-building me-3"></i>
                  <div>
                    <strong th:text="${hostel.name}">Khu trọ</strong>
                    <div class="text-muted" style="font-size: 0.9rem;">
                      <span th:text="${hostelRoomReviewCountMap[hostel.hostelId]}">0</span> đánh giá •
                      ⭐ <span
                        th:text="${#numbers.formatDecimal(hostelRoomAvgRatingMap[hostel.hostelId], 1, 1)}">0.0</span>/5
                    </div>
                  </div>
                </button>
              </h2>
              <div th:id="'collapseRoom' + ${hostel.hostelId}" class="accordion-collapse collapse"
                data-bs-parent="#hostReviewAccordion1">
                <div class="accordion-body">
                  <div th:if="${#lists.isEmpty(hostelRoomReviewsMap[hostel.hostelId])}">
                    <div class="empty-state">
                      <i class="fas fa-comments"></i>
                      <h5>Chưa có đánh giá nào</h5>
                      <p>Khu trọ này chưa có đánh giá phòng.</p>
                    </div>
                  </div>

                  <!-- List đánh giá phòng -->
                  <div th:each="review, stat : ${hostelRoomReviewsMap[hostel.hostelId]}"
                    th:id="'reviewItemRoom' + ${hostel.hostelId} + '_' + ${stat.index}" class="review-item mb-3">
                    <div class="reviewer-info d-flex align-items-start gap-3">
                      <div class="reviewer-avatar rounded-circle bg-primary text-white text-center fw-bold"
                        style="width: 40px; height: 40px; line-height: 40px;"
                        th:text="${review.user.fullname.substring(0,1)}">A</div>
                      <div class="flex-grow-1">
                        <h6 class="mb-0" th:text="${review.user.fullname}">Nguyễn Văn A</h6>
                        <small class="text-muted"
                          th:text="'Phòng ' + ${review.room.namerooms} + ' • ' + ${#dates.format(review.createdAt, 'dd/MM/yyyy')}">Phòng
                          A1 • 01/01/2024</small>
                        <div class="review-rating mt-1" th:utext="${'⭐'.repeat(review.rating)}">⭐⭐⭐⭐</div>
                      </div>
                    </div>
                    <div class="review-content mt-2 ps-5" th:text="${review.comment}">Nội dung đánh giá...</div>
                    <div class="review-actions ps-5 mt-2">
                      <button type="button" class="btn btn-outline-primary btn-sm btn-view-review"
                        data-bs-toggle="modal" data-bs-target="#reviewDetailModal" th:attr="data-reviewer=${review.user.fullname},
                             data-room=${'Phòng ' + review.room.namerooms + ', ' + hostel.name},
                             data-rating=${review.rating},
                             data-time=${#dates.format(review.createdAt, 'dd/MM/yyyy HH:mm')},
                             data-comment=${review.comment}">
                        <i class="fas fa-eye me-1"></i>Xem
                      </button>
                      <!-- Nút xóa trong danh sách đánh giá -->
                      <form th:id="'deleteForm-' + ${review.reviewId}"
                        th:action="@{/chu-tro/danh-gia/delete/{id}(id=${review.reviewId})}" method="post">
                        <button type="button" class="btn btn-outline-danger btn-sm"
                          th:onclick="'confirmDelete(' + ${review.reviewId} + ')'">
                          <i class="fas fa-trash me-1"></i>Xóa
                        </button>
                      </form>

                    </div>
                  </div>

                  <!-- Nút xem thêm -->
                  <div class="ps-5 mt-3">
                    <button type="button" class="btn btn-link btn-sm toggle-reviews-btn"
                      th:data-hostel-id="${hostel.hostelId}" data-type="room">Xem thêm</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab 2: Đánh giá bài đăng -->
        <div class="tab-pane fade" id="postReviews" role="tabpanel">
          <div class="accordion" id="hostReviewAccordion2">
            <div th:each="hostel : ${hostels}" class="accordion-item">
              <h2 class="accordion-header" th:id="'headingPost' + ${hostel.hostelId}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  th:data-bs-target="'#collapsePost' + ${hostel.hostelId}">
                  <i class="fas fa-building me-3"></i>
                  <div>
                    <strong th:text="${hostel.name}">Khu trọ</strong>
                    <div class="text-muted" style="font-size: 0.9rem;">
                      <span th:text="${hostelPostReviewCountMap[hostel.hostelId]}">0</span> đánh giá •
                      ⭐ <span
                        th:text="${#numbers.formatDecimal(hostelPostAvgRatingMap[hostel.hostelId], 1, 1)}">0.0</span>/5
                    </div>
                  </div>
                </button>
              </h2>
              <div th:id="'collapsePost' + ${hostel.hostelId}" class="accordion-collapse collapse"
                data-bs-parent="#hostReviewAccordion2">
                <div class="accordion-body">
                  <div th:if="${#lists.isEmpty(hostelPostReviewsMap[hostel.hostelId])}">
                    <div class="empty-state">
                      <i class="fas fa-comments"></i>
                      <h5>Chưa có đánh giá nào</h5>
                      <p>Khu trọ này chưa có đánh giá bài đăng.</p>
                    </div>
                  </div>

                  <!-- List đánh giá bài đăng -->
                  <div th:each="review, stat : ${hostelPostReviewsMap[hostel.hostelId]}"
                    th:id="'reviewItemPost' + ${hostel.hostelId} + '_' + ${stat.index}" class="review-item mb-3">
                    <div class="reviewer-info d-flex align-items-start gap-3">
                      <div class="reviewer-avatar rounded-circle bg-primary text-white text-center fw-bold"
                        style="width: 40px; height: 40px; line-height: 40px;"
                        th:text="${review.user.fullname.substring(0,1)}">A</div>
                      <div class="flex-grow-1">
                        <h6 class="mb-0" th:text="${review.user.fullname}">Nguyễn Văn A</h6>
                        <small class="text-muted"
                          th:text="'Bài đăng: ' + ${review.post.title} + ' • ' + ${#dates.format(review.createdAt, 'dd/MM/yyyy')}">Bài
                          A • 01/01/2024</small>
                        <div class="review-rating mt-1" th:utext="${'⭐'.repeat(review.rating)}">⭐⭐⭐⭐</div>
                      </div>
                    </div>
                    <div class="review-content mt-2 ps-5" th:text="${review.comment}">Nội dung đánh giá...</div>
                    <div class="review-actions ps-5 mt-2">
                      <button type="button" class="btn btn-outline-primary btn-sm btn-view-review"
                        data-bs-toggle="modal" data-bs-target="#reviewDetailModal" th:attr="data-reviewer=${review.user.fullname},
                             data-room=${'Bài đăng: ' + review.post.title + ', ' + hostel.name},
                             data-rating=${review.rating},
                             data-time=${#dates.format(review.createdAt, 'dd/MM/yyyy HH:mm')},
                             data-comment=${review.comment}">
                        <i class="fas fa-eye me-1"></i>Xem
                      </button>
                      <!-- Nút xóa trong danh sách đánh giá -->
                      <form th:id="'deleteForm-' + ${review.reviewId}"
                        th:action="@{/chu-tro/danh-gia/delete/{id}(id=${review.reviewId})}" method="post">
                        <button type="button" class="btn btn-outline-danger btn-sm"
                          th:onclick="'confirmDelete(' + ${review.reviewId} + ')'">
                          <i class="fas fa-trash me-1"></i>Xóa
                        </button>
                      </form>

                    </div>
                  </div>

                  <!-- Nút xem thêm -->
                  <div class="ps-5 mt-3">
                    <button type="button" class="btn btn-link btn-sm toggle-reviews-btn"
                      th:data-hostel-id="${hostel.hostelId}" data-type="post">Xem thêm</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div> <!-- End Post Tab -->
      </div>
    </div>
  </div>

  <div class="modal fade" id="reviewDetailModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-star me-2"></i>Chi tiết đánh giá
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="modal-info-item">
            <div class="modal-info-label">👤 Người đánh giá</div>
            <div class="modal-info-value">Nguyễn Văn A</div>
          </div>

          <div class="modal-info-item">
            <div class="modal-info-label">🏠 Đối tượng</div>
            <div class="modal-info-value">Phòng A2-105, Khu trọ A2</div>
          </div>

          <div class="modal-info-item">
            <div class="modal-info-label">⭐ Số sao</div>
            <div class="modal-info-value">⭐⭐⭐⭐⭐ (5/5)</div>
          </div>

          <div class="modal-info-item">
            <div class="modal-info-label">📅 Thời gian</div>
            <div class="modal-info-value">25/06/2025 lúc 14:30</div>
          </div>

          <div class="modal-info-item">
            <div class="modal-info-label">💬 Nội dung đánh giá</div>
            <div class="modal-info-value">
              Phòng sạch sẽ, chủ thân thiện, khu vực yên tĩnh. Tiện ích đầy đủ, giá cả hợp lý. Rất hài lòng với chất
              lượng dịch vụ. Sẽ giới thiệu cho bạn bè.
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const modal = document.getElementById("reviewDetailModal");

      const reviewerEl = modal.querySelectorAll(".modal-info-value")[0];
      const roomEl = modal.querySelectorAll(".modal-info-value")[1];
      const ratingEl = modal.querySelectorAll(".modal-info-value")[2];
      const timeEl = modal.querySelectorAll(".modal-info-value")[3];
      const contentEl = modal.querySelectorAll(".modal-info-value")[4];

      document.querySelectorAll(".btn-view-review").forEach(btn => {
        btn.addEventListener("click", function () {
          const reviewer = this.getAttribute("data-reviewer");
          const room = this.getAttribute("data-room");
          const rating = parseInt(this.getAttribute("data-rating"));
          const time = this.getAttribute("data-time");
          const comment = this.getAttribute("data-comment");

          reviewerEl.textContent = reviewer;
          roomEl.textContent = room;
          ratingEl.innerHTML = '⭐'.repeat(rating) + ` (${rating}/5)`;
          timeEl.textContent = time;
          contentEl.textContent = comment;
        });
      });
    });
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.toast-close').forEach(btn => {
        btn.addEventListener('click', () => {
          const toast = btn.closest('.custom-toast');
          toast.style.opacity = '0';
          setTimeout(() => toast.remove(), 300);
        });
      });
      setTimeout(() => {
        document.querySelectorAll('.custom-toast').forEach(toast => {
          toast.style.opacity = '0';
          setTimeout(() => toast.remove(), 300);
        });
      }, 3000);
    });

    document.addEventListener("DOMContentLoaded", function () {
      const limit = 5;

      ['room', 'post'].forEach(type => {
        const prefix = type === 'room' ? 'reviewItemRoom' : 'reviewItemPost';
        const items = document.querySelectorAll(`[id^="${prefix}"]`);
        const groups = {};

        items.forEach(item => {
          const match = item.id.match(/^reviewItem(Room|Post)(\d+)_([\d]+)$/);
          if (!match) return;
          const hostelId = match[2];
          const index = parseInt(match[3]);
          const groupKey = `${type}_${hostelId}`;
          if (!groups[groupKey]) groups[groupKey] = [];
          groups[groupKey].push({ item, index });
        });

        for (const group in groups) {
          groups[group].forEach(({ item, index }) => {
            if (index >= limit) {
              item.style.display = 'none';
            }
          });
        }
      });

      document.querySelectorAll(".toggle-reviews-btn").forEach(button => {
        button.addEventListener("click", () => {
          const hostelId = button.getAttribute("data-hostel-id");
          const type = button.getAttribute("data-type");
          const prefix = type === 'room' ? 'reviewItemRoom' : 'reviewItemPost';

          const reviewItems = Array.from(document.querySelectorAll(`[id^="${prefix}${hostelId}_"]`));
          const isExpanded = button.dataset.expanded === 'true';

          reviewItems.forEach((item, i) => {
            item.style.display = (isExpanded && i >= limit) ? 'none' : 'block';
          });

          button.textContent = isExpanded ? 'Xem thêm' : 'Thu gọn';
          button.dataset.expanded = (!isExpanded).toString();
        });
      });
    });
    function confirmDelete(reviewId) {
      Swal.fire({
        title: 'Bạn có chắc chắn?',
        text: "Xóa đánh giá này không thể hoàn tác!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Xóa',
        cancelButtonText: 'Hủy'
      }).then((result) => {
        if (result.isConfirmed) {
          document.getElementById('deleteForm-' + reviewId).submit();
        }
      });
    }
  </script>

</body>

</html>