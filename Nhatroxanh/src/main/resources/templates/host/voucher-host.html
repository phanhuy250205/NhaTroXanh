<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tạo Voucher - Hệ Thống Quản Lý Phòng Trọ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/voucher-host.css}">
    <link rel="stylesheet" th:href="@{/css/sidebar.css}">
</head>
<body>
    <div th:replace="~{/layouts/sidebar-host}"></div>
    <!-- Main Container -->
    <div class="main-container-voucher">
        <!-- Navigation Tabs -->
        <nav class="main-nav">
            <div class="container-fluid">
                <div class="nav-tabs-container">
                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="showSection('create')" data-section="create">
                            <i class="fas fa-plus-circle"></i>
                            <span>Tạo Voucher</span>
                        </button>
                        <button class="voucher-tab-button" onclick="switchVoucherSection('list')" data-voucher-section="list">
                            <i class="fas fa-list"></i>
                            <span>Danh Sách</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="voucher-main-content">
            <div class="voucher-content-container">
                <!-- Create Voucher Section -->
                <section class="voucher-content-panel voucher-panel-active" id="voucherCreatePanel">
                    <div class="voucher-section-header">
                        <h2>Tạo Voucher Mới</h2>
                        <p>Nhập thông tin để tạo voucher giảm giá</p>
                    </div>

                    <div class="voucher-form-wrapper">
                        <form id="voucherCreationForm" method="POST" action="/vouchers/create">
                            <div class="voucher-form-container">
                                <!-- Thông tin cơ bản -->
                                <div class="voucher-form-block">
                                    <h3><i class="fas fa-info-circle"></i> Thông tin cơ bản</h3>
                                    
                                    <div class="voucher-input-row">
                                        <div class="voucher-field-group">
                                            <label class="voucher-field-label voucher-required-field">Tên voucher</label>
                                            <input type="text" class="voucher-input-control" name="voucherName" id="voucherNameInput" required placeholder="Nhập tên voucher...">
                                            <div class="voucher-error-message">Vui lòng nhập tên voucher</div>
                                        </div>

                                        <div class="voucher-field-group">
                                            <label class="voucher-field-label voucher-required-field">Mã voucher</label>
                                            <div class="voucher-input-group">
                                                <input type="text" class="voucher-input-control" name="voucherCode" id="voucherCodeInput" required placeholder="Nhập mã voucher...">
                                                <button type="button" class="voucher-generate-button" onclick="generateVoucherCode()">
                                                    <i class="fas fa-magic"></i>
                                                    Tạo mã
                                                </button>
                                            </div>
                                            <div class="voucher-error-message">Vui lòng nhập mã voucher</div>
                                        </div>
                                    </div>

                                    <div class="voucher-field-group">
                                        <label class="voucher-field-label">Mô tả voucher</label>
                                        <textarea class="voucher-input-control" name="voucherDescription" id="voucherDescriptionInput" rows="3" placeholder="Mô tả chi tiết về voucher..."></textarea>
                                    </div>

                                    <div class="voucher-input-row">
                                        <div class="voucher-field-group">
                                            <label class="voucher-field-label voucher-required-field">Trạng thái</label>
                                            <select class="voucher-input-control" name="voucherStatus" id="voucherStatusSelect" required>
                                                <option value="active">Kích hoạt ngay</option>
                                                <option value="scheduled">Lên lịch</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <!-- Thiết lập giảm giá -->
                                <div class="voucher-form-block">
                                    <h3><i class="fas fa-percentage"></i> Thiết lập giảm giá</h3>
                                    
                                    <div class="voucher-input-row">
                                        <div class="voucher-field-group">
                                            <label class="voucher-field-label voucher-required-field">Số tiền giảm</label>
                                            <div class="voucher-currency-wrapper">
                                                <input type="number" class="voucher-input-control" name="discountValue" id="voucherDiscountInput" required min="1000" step="1000" placeholder="0">
                                                <div class="voucher-currency-suffix">VNĐ</div>
                                            </div>
                                            <div class="voucher-help-text">Số tiền giảm tối thiểu là 1,000 VNĐ</div>
                                            <div class="voucher-error-message">Vui lòng nhập số tiền giảm hợp lệ</div>
                                        </div>

                                        <div class="voucher-field-group">
                                            <label class="voucher-field-label">Giảm tối đa (tùy chọn)</label>
                                            <div class="voucher-currency-wrapper">
                                                <input type="number" class="voucher-input-control" name="maxDiscount" id="voucherMaxDiscountInput" min="0" step="1000" placeholder="Không giới hạn">
                                                <div class="voucher-currency-suffix">VNĐ</div>
                                            </div>
                                            <div class="voucher-help-text">Để trống nếu không giới hạn</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Thời gian áp dụng -->
                                <div class="voucher-form-block">
                                    <h3><i class="fas fa-calendar-alt"></i> Thời gian áp dụng</h3>
                                    
                                    <div class="voucher-input-row">
                                        <div class="voucher-field-group">
                                            <label class="voucher-field-label voucher-required-field">Ngày bắt đầu</label>
                                            <input type="datetime-local" class="voucher-input-control" name="startDate" id="voucherStartDateInput" required>
                                            <div class="voucher-error-message">Vui lòng chọn ngày bắt đầu</div>
                                        </div>

                                        <div class="voucher-field-group">
                                            <label class="voucher-field-label voucher-required-field">Ngày kết thúc</label>
                                            <input type="datetime-local" class="voucher-input-control" name="endDate" id="voucherEndDateInput" required>
                                            <div class="voucher-error-message">Vui lòng chọn ngày kết thúc</div>
                                        </div>
                                    </div>

                                    <div class="voucher-field-group">
                                        <label class="voucher-field-label">Giới hạn số lần sử dụng</label>
                                        <input type="number" class="voucher-input-control" name="totalUsageLimit" id="voucherUsageLimitInput" min="1" placeholder="Không giới hạn">
                                        <div class="voucher-help-text">Để trống nếu không giới hạn số lần sử dụng</div>
                                    </div>
                                </div>

                                <!-- Phạm vi áp dụng -->
                                <div class="voucher-form-block">
                                    <h3><i class="fas fa-building"></i> Phạm vi áp dụng</h3>
                                    
                                    <div class="voucher-scope-selection">
                                        <div class="voucher-scope-options">
                                            <div class="voucher-scope-item">
                                                <input type="radio" name="hostelScope" value="all" id="voucherScopeAll" checked onchange="toggleVoucherHostelSection()">
                                                <label for="voucherScopeAll" class="voucher-scope-card">
                                                    <i class="fas fa-globe"></i>
                                                    <span>Tất cả khu trọ</span>
                                                </label>
                                            </div>

                                            <div class="voucher-scope-item">
                                                <input type="radio" name="hostelScope" value="specific" id="voucherScopeSpecific" onchange="toggleVoucherHostelSection()">
                                                <label for="voucherScopeSpecific" class="voucher-scope-card">
                                                    <i class="fas fa-map-marker-alt"></i>
                                                    <span>Khu trọ cụ thể</span>
                                                </label>
                                            </div>
                                        </div>

                                        <div class="voucher-hostel-selection" id="voucherHostelSelectionPanel" style="display: none;">
                                            <h4>Chọn khu trọ áp dụng</h4>
                                            <div class="voucher-hostel-list">
                                                <div class="voucher-hostel-item">
                                                    <input type="checkbox" name="selectedHostels" value="1" id="voucherHostel1">
                                                    <label for="voucherHostel1" class="voucher-hostel-card">
                                                        <div class="voucher-hostel-info">
                                                            <h5>Khu trọ Xanh - Quận 1</h5>
                                                            <p>123 Nguyễn Huệ, Quận 1, TP.HCM</p>
                                                            <span class="voucher-hostel-rooms">50 phòng</span>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="voucher-hostel-item">
                                                    <input type="checkbox" name="selectedHostels" value="2" id="voucherHostel2">
                                                    <label for="voucherHostel2" class="voucher-hostel-card">
                                                        <div class="voucher-hostel-info">
                                                            <h5>Khu trọ Hạnh Phúc - Quận 3</h5>
                                                            <p>456 Võ Văn Tần, Quận 3, TP.HCM</p>
                                                            <span class="voucher-hostel-rooms">30 phòng</span>
                                                        </div>
                                                    </label>
                                                </div>

                                                <div class="voucher-hostel-item">
                                                    <input type="checkbox" name="selectedHostels" value="3" id="voucherHostel3">
                                                    <label for="voucherHostel3" class="voucher-hostel-card">
                                                        <div class="voucher-hostel-info">
                                                            <h5>Khu trọ An Khang - Quận 7</h5>
                                                            <p>789 Nguyễn Thị Thập, Quận 7, TP.HCM</p>
                                                            <span class="voucher-hostel-rooms">40 phòng</span>
                                                        </div>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Form Actions -->
                                <div class="voucher-form-actions">
                                    <button type="button" class="voucher-button voucher-button-secondary" onclick="resetVoucherForm()">
                                        <i class="fas fa-refresh"></i>
                                        Làm mới
                                    </button>
                                    <button type="submit" class="voucher-button voucher-button-primary">
                                        <i class="fas fa-save"></i>
                                        Tạo voucher
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Voucher List Section -->
                <section class="voucher-content-panel" id="voucherListPanel">
                    <div class="voucher-section-header">
                        <h2>Danh sách voucher</h2>
                        <p>Quản lý tất cả voucher trong hệ thống</p>
                    </div>

                    <div class="voucher-list-container">
                        <!-- Sample voucher items - Backend sẽ render -->
                        <div class="voucher-list-item">
                            <div class="voucher-item-info">
                                <div class="voucher-item-header">
                                    <h4>Voucher Giảm Giá Tháng 12</h4>
                                    <span class="voucher-status-badge voucher-status-active">Kích hoạt</span>
                                </div>
                                <div class="voucher-item-details">
                                    <p><strong>Mã:</strong> VC123456</p>
                                    <p><strong>Giảm:</strong> 50,000 VNĐ</p>
                                    <p><strong>Thời gian:</strong> 01/12/2024 - 31/12/2024</p>
                                    <p><strong>Sử dụng:</strong> 25/100 lượt</p>
                                </div>
                            </div>
                            <div class="voucher-item-actions">
                                <button class="voucher-action-button voucher-action-edit" onclick="editVoucherItem(1)" title="Chỉnh sửa">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="voucher-action-button voucher-action-delete" onclick="deleteVoucherItem(1)" title="Xóa">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="voucher-action-button voucher-action-toggle" onclick="toggleVoucherItem(1)" title="Bật/Tắt">
                                    <i class="fas fa-power-off"></i>
                                </button>
                            </div>
                        </div>

                        <div class="voucher-list-item">
                            <div class="voucher-item-info">
                                <div class="voucher-item-header">
                                    <h4>Voucher Khách Hàng Mới</h4>
                                    <span class="voucher-status-badge voucher-status-scheduled">Lên lịch</span>
                                </div>
                                <div class="voucher-item-details">
                                    <p><strong>Mã:</strong> VC789012</p>
                                    <p><strong>Giảm:</strong> 100,000 VNĐ</p>
                                    <p><strong>Thời gian:</strong> 15/12/2024 - 15/01/2025</p>
                                    <p><strong>Sử dụng:</strong> 0/50 lượt</p>
                                </div>
                            </div>
                            <div class="voucher-item-actions">
                                <button class="voucher-action-button voucher-action-edit" onclick="editVoucherItem(2)" title="Chỉnh sửa">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="voucher-action-button voucher-action-delete" onclick="deleteVoucherItem(2)" title="Xóa">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="voucher-action-button voucher-action-toggle" onclick="toggleVoucherItem(2)" title="Bật/Tắt">
                                    <i class="fas fa-power-off"></i>
                                </button>
                            </div>
                        </div>

                        <div class="voucher-list-item">
                            <div class="voucher-item-info">
                                <div class="voucher-item-header">
                                    <h4>Voucher Sinh Nhật</h4>
                                    <span class="voucher-status-badge voucher-status-disabled">Vô hiệu hóa</span>
                                </div>
                                <div class="voucher-item-details">
                                    <p><strong>Mã:</strong> VC345678</p>
                                    <p><strong>Giảm:</strong> 75,000 VNĐ</p>
                                    <p><strong>Thời gian:</strong> 01/11/2024 - 30/11/2024</p>
                                    <p><strong>Sử dụng:</strong> 45/100 lượt</p>
                                </div>
                            </div>
                            <div class="voucher-item-actions">
                                <button class="voucher-action-button voucher-action-edit" onclick="editVoucherItem(3)" title="Chỉnh sửa">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="voucher-action-button voucher-action-delete" onclick="deleteVoucherItem(3)" title="Xóa">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="voucher-action-button voucher-action-toggle" onclick="toggleVoucherItem(3)" title="Bật/Tắt">
                                    <i class="fas fa-power-off"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Edit Voucher Modal -->
    <div class="voucher-modal-overlay" id="voucherEditModal" tabindex="-1" aria-hidden="true">
        <div class="voucher-modal-dialog">
            <div class="voucher-modal-content">
                <div class="voucher-modal-header">
                    <h5 class="voucher-modal-title">
                        <i class="fas fa-edit"></i>
                        Chỉnh sửa voucher
                    </h5>
                    <button type="button" class="voucher-modal-close" onclick="closeVoucherModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="voucher-modal-body">
                    <form id="voucherEditForm" method="POST" action="/vouchers/update">
                        <input type="hidden" name="voucherId" id="editVoucherIdInput">
                        
                        <div class="voucher-input-row">
                            <div class="voucher-field-group">
                                <label class="voucher-field-label voucher-required-field">Tên voucher</label>
                                <input type="text" class="voucher-input-control" name="voucherName" id="editVoucherNameInput" required>
                            </div>
                            <div class="voucher-field-group">
                                <label class="voucher-field-label voucher-required-field">Mã voucher</label>
                                <input type="text" class="voucher-input-control" name="voucherCode" id="editVoucherCodeInput" required>
                            </div>
                        </div>
                        
                        <div class="voucher-field-group">
                            <label class="voucher-field-label">Mô tả</label>
                            <textarea class="voucher-input-control" name="voucherDescription" id="editVoucherDescriptionInput" rows="3"></textarea>
                        </div>
                        
                        <div class="voucher-input-row">
                            <div class="voucher-field-group">
                                <label class="voucher-field-label voucher-required-field">Số tiền giảm</label>
                                <div class="voucher-currency-wrapper">
                                    <input type="number" class="voucher-input-control" name="discountValue" id="editVoucherDiscountInput" required min="1000" step="1000">
                                    <div class="voucher-currency-suffix">VNĐ</div>
                                </div>
                            </div>
                            <div class="voucher-field-group">
                                <label class="voucher-field-label">Giảm tối đa</label>
                                <div class="voucher-currency-wrapper">
                                    <input type="number" class="voucher-input-control" name="maxDiscount" id="editVoucherMaxDiscountInput" min="0" step="1000">
                                    <div class="voucher-currency-suffix">VNĐ</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="voucher-input-row">
                            <div class="voucher-field-group">
                                <label class="voucher-field-label voucher-required-field">Ngày bắt đầu</label>
                                <input type="datetime-local" class="voucher-input-control" name="startDate" id="editVoucherStartDateInput" required>
                            </div>
                            <div class="voucher-field-group">
                                <label class="voucher-field-label voucher-required-field">Ngày kết thúc</label>
                                <input type="datetime-local" class="voucher-input-control" name="endDate" id="editVoucherEndDateInput" required>
                            </div>
                        </div>
                        
                        <div class="voucher-input-row">
                            <div class="voucher-field-group">
                                <label class="voucher-field-label">Giới hạn sử dụng</label>
                                <input type="number" class="voucher-input-control" name="totalUsageLimit" id="editVoucherUsageLimitInput" min="1">
                            </div>
                            <div class="voucher-field-group">
                                <label class="voucher-field-label voucher-required-field">Trạng thái</label>
                                <select class="voucher-input-control" name="voucherStatus" id="editVoucherStatusSelect" required>
                                    <option value="active">Kích hoạt</option>
                                    <option value="scheduled">Lên lịch</option>
                                    <option value="disabled">Vô hiệu hóa</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="voucher-modal-footer">
                    <button type="button" class="voucher-button voucher-button-secondary" onclick="closeVoucherModal()">Hủy</button>
                    <button type="submit" class="voucher-button voucher-button-primary" form="voucherEditForm">
                        <i class="fas fa-save"></i>
                        Lưu thay đổi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="voucher-toast-container">
        <div class="voucher-toast voucher-toast-success" id="voucherSuccessToast">
            <div class="voucher-toast-content">
                <div class="voucher-toast-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="voucher-toast-text">
                    <div class="voucher-toast-title">Thành công!</div>
                    <div class="voucher-toast-message" id="voucherSuccessMessage">Thao tác đã được thực hiện thành công.</div>
                </div>
            </div>
            <button class="voucher-toast-close" onclick="hideVoucherToast('voucherSuccessToast')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="voucher-toast voucher-toast-error" id="voucherErrorToast">
            <div class="voucher-toast-content">
                <div class="voucher-toast-icon">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <div class="voucher-toast-text">
                    <div class="voucher-toast-title">Lỗi!</div>
                    <div class="voucher-toast-message" id="voucherErrorMessage">Có lỗi xảy ra, vui lòng thử lại.</div>
                </div>
            </div>
            <button class="voucher-toast-close" onclick="hideVoucherToast('voucherErrorToast')">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/voucher-host.js}"></script>
    <script th:src="@{/js/sidebar.js}"></script>
</body>
</html>