<!DOCTYPE html>
<html lang="en">

<head th:replace="~{/layouts/head}">
  <title>Chi Tiết - Nhà Trọ Xanh</title>
</head>
<style>
  .custom-toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1055;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .custom-toast {
    display: flex;
    align-items: center;
    background-color: #e6f7f0;
    color: #1a2e05;
    padding: 12px 16px;
    border-left: 5px solid #10b981;
    border-radius: 10px;
    min-width: 320px;
    max-width: 400px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    font-size: 15px;
    position: relative;
    animation: slideIn 0.3s ease-out;
  }

  .custom-toast.error {
    background-color: #fff0f0;
    border-left-color: #ef4444;
    color: #7f1d1d;
  }

  .toast-icon {
    margin-right: 10px;
    font-size: 18px;
    color: #10b981;
  }

  .custom-toast.error .toast-icon {
    color: #ef4444;
  }

  .toast-message {
    flex: 1;
  }

  .toast-close {
    background: none;
    border: none;
    font-size: 18px;
    color: #999;
    cursor: pointer;
    transition: color 0.2s;
  }

  .toast-close:hover {
    color: #333;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(50px);
    }

    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>

<body>
  <div th:replace="~{/layouts/sidebar-host}"></div>
  <div class="main-content">
    <h4 class="mb-4">Quản lý yêu cầu gia hạn / trả phòng</h4>
    <hr>
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
      <div class="d-flex flex-grow-1 gap-3" style="max-width: 500px;">
        <input type="text" class="form-control search-rounded" placeholder="Tìm kiếm..." />
        <button class="btn btn-search-rounded">TÌM KIẾM</button>
      </div>
    </div>
    <div class="custom-toast-container">
      <div th:if="${successMessage}" class="custom-toast success">
        <i class="toast-icon fas fa-check-circle"></i>
        <span class="toast-message" th:text="${successMessage}"></span>
        <button class="toast-close" aria-label="Đóng">×</button>
      </div>
      <div th:if="${errorMessage}" class="custom-toast error">
        <i class="toast-icon fas fa-exclamation-circle"></i>
        <span class="toast-message" th:text="${errorMessage}"></span>
        <button class="toast-close" aria-label="Đóng">×</button>
      </div>
    </div>
    <div class="row row-cols-1 row-cols-md-3 g-4" th:if="${requests != null}">
      <div class="col" th:each="req, iterStat : ${requests}">
        <div class="card shadow-sm h-100">
          <div class="card-body">
            <h5 class="card-title"
              th:text="${req.contract.tenant != null ? req.contract.tenant.fullname : req.contract.unregisteredTenant.fullname}">
              Tên người thuê</h5>
            <p class="card-text mb-1">
              <strong>Phòng:</strong> <span th:text="${req.contract.room.namerooms}">Tên phòng</span>
            </p>
            <p class="card-text mb-1">
              <strong>Loại yêu cầu:</strong> Gia hạn
            </p>
            <p class="card-text mb-1">
              <strong>Thời gian:</strong>
              <span th:text="${#dates.format(req.contract.endDate, 'dd/MM/yyyy')}"></span>
              →
              <span th:text="${#dates.format(req.requestedExtendDate, 'dd/MM/yyyy')}"></span>
            </p>
            <button class="btn btn-outline-primary btn-sm mt-3" data-bs-toggle="modal"
              th:attr="data-bs-target='#requestModal__' + ${iterStat.index}">
              <i class="fa-solid fa-eye"></i> Xem chi tiết
            </button>

          </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" th:id="'requestModal__' + ${iterStat.index}" tabindex="-1"
          aria-labelledby="host-modal-title" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-lg host-modal">
            <div class="modal-content host-modal-content shadow-sm">
              <div class="modal-header border-0">
                <h5 class="modal-title" id="host-modal-title">
                  <i class="fa-solid fa-file-signature me-2 text-primary"></i>Chi tiết yêu cầu gia hạn
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
              </div>
              <div class="modal-body host-modal-body">
                <div class="row mb-2">
                  <div class="col-md-6">
                    <i class="fa-solid fa-user me-1 text-secondary"></i>
                    <strong>Họ tên:</strong>
                    <span
                      th:text="${req.contract.tenant != null ? req.contract.tenant.fullname : req.contract.unregisteredTenant.fullname}"></span>
                  </div>
                  <div class="col-md-6">
                    <i class="fa-solid fa-phone me-1 text-secondary"></i>
                    <strong>SĐT:</strong>
                    <span th:text="${req.contract.tenantPhone}"></span>
                  </div>
                </div>

                <div class="row mb-2">
                  <div class="col-md-6">
                    <i class="fa-solid fa-door-open me-1 text-secondary"></i>
                    <strong>Phòng:</strong> <span th:text="${req.contract.room.namerooms}"></span>
                  </div>
                  <div class="col-md-6">
                    <i class="fa-solid fa-file-contract me-1 text-secondary"></i>
                    <strong>Hợp đồng:</strong> <span th:text="'#CTR' + ${req.contract.contractId}"></span>
                  </div>
                </div>

                <div class="row mb-2">
                  <div class="col-md-6">
                    <i class="fa-solid fa-tag me-1 text-secondary"></i>
                    <strong>Loại yêu cầu:</strong> Gia hạn
                  </div>
                  <div class="col-md-6">
                    <i class="fa-solid fa-calendar me-1 text-secondary"></i>
                    <strong>Thời gian hiện tại:</strong>
                    <span th:text="${#dates.format(req.contract.startDate, 'dd/MM/yyyy')}"></span>
                    – <span th:text="${#dates.format(req.contract.endDate, 'dd/MM/yyyy')}"></span>
                  </div>
                </div>

                <div class="row mb-2">
                  <div class="col-md-6">
                    <i class="fa-solid fa-calendar-plus me-1 text-secondary"></i>
                    <strong>Gia hạn đến:</strong> <span
                      th:text="${#dates.format(req.requestedExtendDate, 'dd/MM/yyyy')}"></span>
                  </div>
                </div>

                <div class="mt-3">
                  <i class="fa-solid fa-pen me-1 text-secondary"></i>
                  <strong>Lý do:</strong> <span th:text="${req.message}">Không có</span>
                </div>
              </div>

              <div class="modal-footer border-0 pt-0">
                <form th:action="@{/chu-tro/gia-hang-tra-phong/duyet}" method="post" class="me-2">
                  <input type="hidden" name="requestId" th:value="${req.requestId}">
                  <button type="submit" class="btn host-btn-approve">
                    <i class="fa-solid fa-check me-1"></i> Phê duyệt
                  </button>
                </form>
                <form th:action="@{/chu-tro/gia-hang-tra-phong/tu-choi}" method="post">
                  <input type="hidden" name="requestId" th:value="${req.requestId}">
                  <button type="submit" class="btn host-btn-reject">
                    <i class="fa-solid fa-xmark me-1"></i> Từ chối
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.querySelectorAll('.toast-close').forEach(btn => {
        btn.addEventListener('click', () => {
          const toast = btn.closest('.custom-toast');
          toast.style.opacity = '0';
          setTimeout(() => toast.remove(), 300);
        });
      });
      setTimeout(() => {
        document.querySelectorAll('.custom-toast').forEach(toast => {
          toast.style.opacity = '0';
          setTimeout(() => toast.remove(), 300);
        });
      }, 3000);
    });
  </script>
</body>

</html>