<!DOCTYPE html>
<html lang="vi">

<head th:replace="~{/layouts/head}" />

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết bài đăng</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style>
        :root {
            --primary-blue: #3E83CC;
            --secondary-blue: #549eed;
            --dark-blue: #1f2937;
            --warning-orange: #f59e0b;
            --gradient-primary: linear-gradient(135deg, #3E83CC 0%, #549eed 100%);
            --shadow-primary: 0 2px 8px rgba(62, 131, 204, 0.15);
            --shadow-hover: 0 3px 12px rgba(62, 131, 204, 0.2);
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .post-info {
            font-size: 14px;
        }

        .post-status {
            font-weight: 600;
            font-size: 14px;
            padding: 6px 16px;
            border-radius: 20px;
            background-color: var(--warning-orange);
            color: white;
        }

        .staff-back-link {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-blue);
            text-decoration: none;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .staff-back-link:hover {
            color: var(--secondary-blue);
            transform: translateX(-2px);
        }

        .staff-status-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--dark-blue);
            margin-right: 8px;
        }

        .post-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .post-price {
            font-size: 24px;
            color: var(--warning-orange);
            font-weight: bold;
        }

        .post-meta {
            font-size: 14px;
            margin-bottom: 6px;
        }

        .post-section-title {
            font-size: 20px;
            font-weight: 600;
            margin: 30px 0 10px;
        }

        .details-table td {
            padding: 8px 0;
        }

        .details-table td:first-child {
            font-weight: 600;
            width: 150px;
        }

        .action-buttons {
            margin-top: 30px;
            text-align: center;
        }

        .btn-approve {
            background-color: #10b981;
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            margin-right: 16px;
        }

        .btn-delete {
            background-color: #ef4444;
            color: white;
            padding: 10px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
        }

        .staff-content-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border: 1px solid rgba(62, 131, 204, 0.1);
            box-shadow: var(--shadow-primary);
            transition: all 0.2s ease;
        }

        .staff-content-section:hover {
            box-shadow: var(--shadow-hover);
        }

        .staff-gallery-section {
            margin-bottom: 20px;
        }

        .staff-main-image {
            width: 100%;
            height: 500px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 2px solid rgba(62, 131, 204, 0.1);
            transition: all 0.2s ease;
        }

        .staff-main-image:hover {
            border-color: var(--primary-blue);
            box-shadow: 0 4px 16px rgba(62, 131, 204, 0.2);
        }

        .staff-thumbnails-container {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            padding-bottom: 10px;
        }

        .staff-thumbnails-container::-webkit-scrollbar {
            height: 8px;
        }

        .staff-thumbnails-container::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }

        .staff-thumbnail {
            width: 100px;
            height: 70px;
            object-fit: cover;
            border-radius: 6px;
            margin-right: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
            border: 2px solid rgba(62, 131, 204, 0.2);
        }

        .staff-thumbnail:hover {
            transform: scale(1.05);
        }

        .staff-thumbnail.active {
            border: 2px solid var(--primary-blue);
        }

        .staff-info-section {
            background: linear-gradient(135deg, rgba(62, 131, 204, 0.05) 0%, rgba(37, 99, 235, 0.02) 100%);
            border-left: 4px solid var(--primary-blue);
            border-radius: 12px;
            padding: 24px;
        }

        .staff-property-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark-blue);
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .staff-price-container {
            margin-bottom: 20px;
        }

        .staff-price {
            font-size: 28px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .staff-price-note {
            font-size: 14px;
            color: #6b7280;
            font-style: italic;
        }

        .staff-info-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px 0;
        }

        .staff-info-icon {
            width: 20px;
            height: 20px;
            color: var(--primary-blue);
            flex-shrink: 0;
        }

        .staff-info-text {
            font-size: 14px;
            color: var(--dark-blue);
            line-height: 1.4;
        }

        .staff-info-text strong {
            font-weight: 600;
            margin-right: 8px;
        }

        .staff-description-section {
            margin-bottom: 24px;
        }

        .staff-section-title {
            font-size: 20px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            position: relative;
        }

        .staff-section-title::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 1px;
        }

        .staff-description-text {
            font-size: 16px;
            line-height: 1.6;
            color: var(--dark-blue);
            margin-bottom: 20px;
        }

        .staff-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .staff-details-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(62, 131, 204, 0.1);
            box-shadow: 0 2px 8px rgba(62, 131, 204, 0.05);
        }

        .staff-details-card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-blue);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .staff-details-table {
            width: 100%;
        }

        .staff-details-table tr {
            border-bottom: 1px solid rgba(62, 131, 204, 0.1);
        }

        .staff-details-table tr:last-child {
            border-bottom: none;
        }

        .staff-details-table td {
            padding: 12px 0;
            font-size: 14px;
            vertical-align: top;
        }

        .staff-details-table td:first-child {
            font-weight: 600;
            color: var(--dark-blue);
            width: 40%;
        }

        .staff-details-table td:last-child {
            color: #6b7280;
            font-weight: 500;
        }

        /* Responsive adjustments for header */
        @media (max-width: 768px) {
            .post-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .staff-back-link {
                margin-bottom: 12px;
            }

            .post-info {
                margin-bottom: 12px;
            }

            .post-status-container {
                display: flex;
                align-items: center;
                gap: 8px;
            }
        }
    </style>
</head>

<body>
    <div th:replace="~{/layouts/sidebar-staff}"></div>
    <div class="main-content">
        <!-- Integrated provided row with title -->
        <div class="row align-items-center mb-3">
            <div class="col-12 d-flex align-items-center">
                <a href="/nhan-vien/bai-dang" class="staff-back-link me-3">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <h4 class="mb-0">Chi tiết bài đăng</h4>
            </div>
            <div class="col-12">
                <hr>
            </div>
        </div>

        <div class="post-header">

            <div class="post-info">
                <div>Người đăng: <strong th:text="${author.fullname}">Trần Văn B</strong> </div>
                <div>Ngày đăng: <span
                        th:text="${post != null && post.createdAt != null ? #dates.format(post.createdAt, 'dd/MM/yyyy') : '01/01/2024'}">28/05/2025</span>
                </div>
            </div>
            <div class="post-status-container">
                <span class="staff-status-label">Trạng thái:</span>
                <span class="post-status badge" th:classappend="| ${
            post.approvalStatus != null ?
            post.approvalStatus.name() == 'APPROVED' ? 'bg-success text-white' :
            post.approvalStatus.name() == 'PENDING' ? 'bg-warning text-dark' :
            'bg-danger text-white' : 'bg-secondary text-white'
        } |" th:text="|${
            post.approvalStatus != null ?
            post.approvalStatus.name() == 'APPROVED' ? 'Đã duyệt' :
            post.approvalStatus.name() == 'PENDING' ? 'Chờ duyệt' :
            'Bị từ chối' : 'Chưa xác định'
        }|">
                </span>
            </div>

        </div>

        <!-- Gallery Section -->
        <div class="staff-content-section staff-gallery-section">
            <div class="row">
                <div class="col-lg-8 col-md-12">
                    <img th:if="${images != null and !#lists.isEmpty(images)}" th:src="${images[0]}"
                        alt="Hình ảnh chính" class="staff-main-image" id="mainImage"
                        onerror="this.src='/images/cards/default.jpg';">
                    <img th:unless="${images != null and !#lists.isEmpty(images)}" src="/images/cards/default.jpg"
                        alt="Hình ảnh chính" class="staff-main-image" id="mainImage">

                    <div class="staff-thumbnails-container d-flex">
                        <div th:each="image : ${images}">
                            <img th:src="${image}" class="staff-thumbnail" th:alt="'Hình ảnh phụ'"
                                th:onclick="'changeMainImage(this)'">
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-12">
                    <div class="staff-info-section">
                        <h1 class="staff-property-title"
                            th:text="${post != null && post.title != null ? post.title : 'Tiêu đề bài đăng'}">
                            NHÀ TRỌ SỐ 123, ĐƯỜNG ABC, P.THANH KHÊ ĐÔNG, Q.THANH KHÊ, TP.ĐÀ NẴNG
                        </h1>
                        <div class="staff-price-container">
                            <div class="staff-price"
                                th:text="|${#numbers.formatDecimal(post.price, 0, 'COMMA', 0, 'POINT')} VNĐ/tháng|">
                                2.5 triệu/tháng
                            </div>

                            <div class="staff-price-note">(Chưa bao gồm phí dịch vụ)</div>
                        </div>
                        <div class="staff-info-item">
                            <i class="bi bi-bounding-box-circles staff-info-icon"></i>
                            <div class="staff-info-text"><strong>Diện tích:</strong> <span
                                    th:text="${#numbers.formatDecimal(post.area, 1, 'COMMA', 0, 'POINT')} + 'm²'">20m²</span>
                            </div>
                        </div>
                        <div class="staff-info-item">
                            <i class="bi bi-house-heart staff-info-icon"></i>
                            <div class="staff-info-text"><strong>Loại hình:</strong><span
                                    th:text="${post.category != null ? post.category.name : 'Chưa xác định'}">Nhà trọ,
                                    phòng trọ</span></div>
                        </div>
                        <div class="staff-info-item">
                            <i class="bi bi-geo-alt-fill staff-info-icon"></i>
                            <div class="staff-info-text"><strong>Địa chỉ:</strong> <span
                                    th:text="${post.address != null ? post.address.street + ', ' + post.address.ward.name + ', ' + post.address.ward.district.name + ', ' + post.address.ward.district.province.name : 'Chưa xác định'}">Thanh
                                    Khê, TP. Đà Nẵng</span></div>
                        </div>
                        <div class="staff-info-item">
                            <i class="bi bi-clock-fill staff-info-icon"></i>
                            <div class="staff-info-text"><strong>Ngày đăng:</strong><span
                                    th:text="${post != null && post.createdAt != null ? #dates.format(post.createdAt, 'dd/MM/yyyy') : '01/01/2024'}">28/05/2025</span>
                            </div>
                        </div>
                        <div class="staff-info-item">
                            <i class="bi bi-houses-fill info-icon-host" style="color: #007bff;"></i>
                            <div class="staff-info-text"><strong>Nhà trọ:</strong> <span
                                    th:text="${hostel != null ? hostel.name : 'Không liên kết nhà trọ'}">Nhà trọ
                                    ABC</span>
                            </div>
                        </div>
                        <div class="staff-info-item">
                            <i class="bi bi-door-open-fill info-icon-host" style="color: #007bff;"></i>
                            <div class="staff-info-text"><strong>Số lượng phòng:</strong> <span
                                    th:text="${roomCount != null ? roomCount : 0}">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Description Section -->
        <div class="staff-content-section">
            <div class="staff-description-section">
                <h2 class="staff-section-title">Mô tả chi tiết</h2>
                <p class="staff-description-text"
                    th:text="${post.description != null ? post.description : 'Chưa có mô tả'}">
                    Phòng trọ cao cấp tại trung tâm thành phố Đà Nẵng, gần các trường đại học và khu vực thương mại sầm
                    uất.
                    Phòng được thiết kế hiện đại, đầy đủ nội thất cao cấp, tạo không gian sống thoải mái và tiện nghi
                    cho người thuê.
                </p>
                <div class="staff-details-grid">
                    <div class="staff-details-card">
                        <h3 class="staff-details-card-title">
                            <i class="fas fa-info-circle"></i>
                            Thông tin cơ bản
                        </h3>
                        <div class="amenity-list">
                            <p th:if="${utilities == null or #sets.isEmpty(utilities)}" class="text-muted">
                                Phòng này hiện không có tiện ích nào.
                            </p>
                            <div th:unless="${utilities == null or #sets.isEmpty(utilities)}">
                                <ul class="list-unstyled">
                                    <li class="amenity-item mb-2" th:each="utility : ${utilities}">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <span
                                            th:text="${utility.name != null ? utility.name : 'Tiện ích không xác định'}"></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="staff-details-card">
                        <h3 class="staff-details-card-title">
                            <i class="fas fa-door-open"></i>
                            Danh sách phòng
                        </h3>

                        <div th:if="${rooms == null or #lists.isEmpty(rooms)}" class="text-muted">
                            Nhà trọ này hiện không có phòng nào.
                        </div>

                        <div th:unless="${rooms == null or #lists.isEmpty(rooms)}">
                            <div th:each="room : ${rooms}" class="room-item-host" th:data-room-id="${room.roomId}"
                                onclick="openRoomModal(this.getAttribute('data-room-id'))">

                                <div class="room-item-title-host"
                                    th:text="${room.namerooms != null ? room.namerooms : 'Phòng không tên'}"></div>

                                <div class="room-item-info-host">
                                    <span
                                        th:text="'Giá: ' + ${#numbers.formatDecimal(room.price, 0, 'COMMA', 0, 'POINT')} + ' VNĐ/tháng'"></span>
                                    |
                                    <span
                                        th:text="'Diện tích: ' + ${#numbers.formatDecimal(room.acreage, 1, 'COMMA', 0, 'POINT')} + ' m²'"></span>
                                    |
                                    <span
                                        th:text="'Số người tối đa: ' + ${room.max_tenants != null ? room.max_tenants : 'Chưa xác định'}"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="action-buttons text-center mt-4">
            <!-- Trạng thái CHỜ DUYỆT -->
            <div th:if="${post.approvalStatus.name() == 'PENDING'}"
                class="d-flex justify-content-center gap-3 flex-wrap">
                <!-- Nút DUYỆT -->
                <form th:action="@{/nhan-vien/bai-dang/{postId}/approve(postId=${post.postId})}" method="post">
                    <button type="submit" class="btn btn-success d-flex align-items-center">
                        <i class="fas fa-check-circle me-2"></i> DUYỆT BÀI
                    </button>
                </form>

                <!-- Nút TỪ CHỐI với SweetAlert -->
                <form th:action="@{/nhan-vien/bai-dang/{postId}/reject(postId=${post.postId})}" method="post"
                    class="form-reject">
                    <button type="button" class="btn btn-danger d-flex align-items-center btn-reject"
                        th:data-post-id="${post.postId}">
                        <i class="fas fa-times-circle me-2"></i> TỪ CHỐI
                    </button>
                </form>
            </div>

            <!-- Trạng thái ĐÃ DUYỆT -->
            <div th:if="${post.approvalStatus.name() == 'APPROVED'}" class="mt-3">
                <form th:action="@{/nhan-vien/bai-dang/cap-nhat-trang-thai}" method="post">
                    <input type="hidden" name="postId" th:value="${post.postId}" />
                    <button type="submit" class="btn d-flex align-items-center"
                        th:classappend="${post.status} ? 'btn-warning' : 'btn-info'">
                        <i class="fas" th:classappend="${post.status} ? 'fa-eye-slash me-2' : 'fa-eye me-2'"></i>
                        <span th:text="${post.status} ? 'ẨN BÀI' : 'HIỂN BÀI'"></span>
                    </button>
                </form>
            </div>
        </div>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function changeMainImage(element) {
            const mainImage = document.getElementById('mainImage');
            mainImage.style.opacity = '0'; // Start fade-out
            mainImage.src = element.src;
            mainImage.onload = () => {
                mainImage.style.transition = 'opacity 0.3s ease';
                mainImage.style.opacity = '1'; // Fade-in
            };
            document.querySelectorAll('.staff-thumbnail').forEach(img => img.classList.remove('active'));
            element.classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', function () {
            const mainImage = document.getElementById('mainImage');
            const thumbnails = document.querySelectorAll('.staff-thumbnail');

            // Set first thumbnail as active by default
            if (thumbnails.length > 0) {
                thumbnails[0].classList.add('active');
            }

            // Add hover effects for thumbnails
            thumbnails.forEach(thumb => {
                thumb.addEventListener('mouseenter', function () {
                    if (!this.classList.contains('active')) {
                        this.style.transform = 'scale(1.05)';
                    }
                });

                thumb.addEventListener('mouseleave', function () {
                    if (!this.classList.contains('active')) {
                        this.style.transform = 'scale(1)';
                    }
                });
            });
        });
        document.addEventListener("DOMContentLoaded", function () {
            // TỪ CHỐI bài đăng
            document.querySelectorAll('.btn-reject').forEach(button => {
                button.addEventListener('click', function () {
                    const form = button.closest('form');
                    Swal.fire({
                        title: 'Xác nhận từ chối?',
                        text: "Bạn có chắc chắn muốn từ chối duyệt bài đăng này?",
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#d33',
                        cancelButtonColor: '#3085d6',
                        confirmButtonText: 'Có',
                        cancelButtonText: 'Hủy bỏ'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            form.submit();
                        }
                    });
                });
            });
        });
    </script>
</body>

</html>